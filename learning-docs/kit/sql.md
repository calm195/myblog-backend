# SQL

## 事务

MySQL InnoDB 存储引擎默认支持的是`REPEATABLE_READ`。  
> 在标准的隔离级别里可重复读不可阻止幻读，但InnoDB实现的可重复读可以做到。
> 主要有两种情况：
>
> - 快照读：由MVCC机制保证
> - 当前读：使用Next-Key Lock进行加锁保证。Next-Key Lock是行锁和间隙锁的结合，行锁锁住行的同时需要依赖间隙锁避免插入新行

1. 事务隔离级别
    1. `READ_UNCOMMITTED` **(读取未提交)** :最低的隔离级别，使用这个隔离级别很少，因为它允许读取尚未提交的数据变更，可能会导致脏读、幻读或不可重复读
    2. `READ_COMMITTED` **(读取已提交)**: 允许读取并发事务已经提交的数据，可以阻止脏读，但是幻读或不可重复读仍有可能发生
    3. `REPEATABLE_READ` **(可重复读)**: 对同一字段的多次读取结果都是一致的，除非数据是被本身事务自己所修改，可以阻止脏读和不可重复读，但幻读仍有可能发生。
    4. `SERIALIZABLE` **(可串行化)**: 最高的隔离级别，完全服从 ACID 的隔离级别。所有的事务依次逐个执行，这样事务之间就完全不可能产生干扰，也就是说，该级别可以防止脏读、不可重复读以及幻读。但是这将严重影响程序的性能。通常情况下也不会用到该级别。
